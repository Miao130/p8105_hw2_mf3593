---
title: "p8105_hw2_mf3593"
author: "Miao Fu"
date: "2023-09-26"
output: html_document
---

## Problem 1
```{r}
library(tidyverse)
library(dplyr)
```

```{r}
pols_df=read_csv("data/pols-month.csv")|>
  janitor::clean_names()|>
  separate(mon, into=c("year","month","day"), "-")|>
  mutate(
    month=toupper(month.abb[as.numeric(month)]),
    president=ifelse(prez_gop==1,"gop","dem"))|>
  select(-c(prez_dem,prez_gop,day))
```
```{r}
snp_df=read_csv("data/snp.csv")|>
  janitor::clean_names()|>
  mutate(date=as.Date(date,format=("%m/%d/%Y")))|>
  separate(date, into=c("year","month","day"), "-")|>
  mutate(year=ifelse(as.numeric(year)>=0 & as.numeric(year)<=9,paste0("200",year),ifelse(as.numeric(year)<=15,paste0("20",year),paste0("19",year))),
         month=toupper(month.abb[as.numeric(month)]))|>
  arrange(month,year)|>
  select(year,month,everything())
```
```{r}
unemploy_df=read_csv("data/unemployment.csv")|>
  janitor::clean_names()|>
  pivot_longer(
    jan:dec,
    names_to = "month",
    values_to= "unemployment"
  )|>
  mutate(month=toupper(month), year=as.character(year))
```
```{r}
snp_pols=left_join(pols_df,snp_df,by=c("year","month"))|>
  left_join(unemploy_df,by=c("year","month"))
```

The pols_df dataset contains data record of `r colnames(pols_df)` from year 1947 to 2015. It records number of people in republican and demographic senators, as well as which party the president is from. It has 822 obs of 9 varaibles. The snp_df dataset contains data record of `r colnames(snp_df)` from year 1950 to 2014. It has 787 obs of 4 variables. The unemploy_df contains data record of `r colnames(unemploy_df)` from year 1948 to 2015. It has 816 obs of 3 variables. The snp_pols combine all three datasets according to year and month columns, and it has 822 obs of 12 variables. 

## Problem 2
```{r}
library("readxl")
```

```{r}
trash_df=read_excel("data/trashwheel.xlsx",sheet="Mr. Trash Wheel")|>
  janitor::clean_names()|>
  select(-c("x15","x16"))|>
  drop_na(dumpster)|>
  mutate(homes_powered=(weight_tons*500)/30,
         setname="Mr.Trash",
         year=as.numeric(year))
```
```{r}
professor_df=read_excel("data/trashwheel.xlsx", sheet="Professor Trash Wheel")|>
  janitor::clean_names()|>
  drop_na(dumpster)|>
  mutate(homes_powered=(weight_tons*500)/30,
         setname="Professor")

Gwynnda_df=read_excel("data/trashwheel.xlsx", sheet="Gwynnda Trash Wheel")|>
  janitor::clean_names()|>
  drop_na(dumpster)|>
  mutate(homes_powered=(weight_tons*500)/30,
         setname="Gwynnda")

combined_df=bind_rows(trash_df,professor_df,Gwynnda_df)|>
  select(setname,everything())

wt_prof=pull(professor_df, weight_tons)|>sum()
Gwynnda_cigarett=pull(Gwynnda_df[Gwynnda_df$month=='July' & Gwynnda_df$year==2021,],cigarette_butts)|>
  sum()
```

There are 747 observations in total for three datasets combined. Mr. Trash_wheel dataset has the most number of observations (547) and most numbers of varaibles(15). Mr.Trashwheel dataset records information on `r colnames(trash_df)`. Professor and Gwynnda dataset also collect data on the dumpsters and different types of trash there are. They recorded slightly different types of trash compared to Mr.Trashwheel dataset. For example, professor trash wheel doesn't record number of sports_balls. Gwynnda Trash wheel doesn't have records of glass_bottles, grocery_bags,chip_bags, and sports_balls, but it has records of number of plastic bags which the other two datasets don't have. The total weight of trash collected by Professor Trash Wheel is `r wt_prof`. The total number of cigarette butts collected by Gwynnda in July of 2021 is `r Gwynnda_cigarett`.

## Problem 3
```{r}
bl_df=read_csv("data_mci/MCI_baseline.csv",skip=1)|>
  janitor::clean_names()|>
  mutate(
    sex=case_match( 
      sex,
    1 ~ "Male",
    0 ~ "Female"),
    apoe4=case_match(
      apoe4,
    1 ~ "APOE4 carrier",
    0 ~ "APOE4 non-carrier"
    ))

cleaned_bl=bl_df[bl_df$age_at_onset!='.',]
```
The dataset for baseline MCI includes information on subjects' sex, age, years of education, APOE4 carrier status, and age of onset of AD. A total of 483 subjects were recruited for the baseline study. 97 developed MCI. The average baseline age is `r mean(cleaned_bl$current_age)`. `r (nrow(cleaned_bl[cleaned_bl$sex=='Female'&cleaned_bl$apoe4=='APOE4 carrier',])/nrow(cleaned_bl[cleaned_bl$sex=='Female',]))*100`% of women in the baseline study are APOE4 carriers.

```{r}
amyloid_df=read_csv("data_mci/mci_amyloid.csv", skip=1)|>
  janitor::clean_names()|>
  apply(c(1,2),function(x) ifelse(x=="Na", NA, x))|>
  as.data.frame()|>
  mutate(study_id=as.numeric(study_id))|>
  rename(id=study_id)
```
The dataset for biomarker amyloid includes information on subjects time(in years) elapsed since the study baseline to the visit where biomarker amyloid 42/40 ratio was measured. A total of 5 times of records are included. The dataset has `r nrow(amyloid_df)` rows and `r ncol(amyloid_df)` columns. 

```{r}
bl_only=subset(cleaned_bl, !(id %in% amyloid_df$id))
amyloid_only=subset(amyloid_df, !(id %in% cleaned_bl$id))
combined_df_AD=inner_join(cleaned_bl,amyloid_df,by='id')
write.csv(combined_df_AD, file="data_mci/combined_df.csv")
```

There are 3 subjects that is in the baseline study but not in amyloid dataset. There are 393 observations in the amyloid dataset only. The combined dataset of subjects records in both dataset has 94 rows and 11 columns. It combines the varaibles recorded in both datasets, including `r colnames(combined_df_AD)`
